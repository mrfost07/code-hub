{% load static %}
<nav class="main-header navbar navbar-expand navbar-dark">
  <style>
    /* Responsive Navbar Improvements */
    @media (max-width: 768px) {
      .main-header {
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1040;
      }

      .navbar-nav .nav-link {
        padding: 0.75rem 1rem;
      }

      /* Profile Dropdown Improvements */
      .navbar .dropdown-menu {
        position: fixed !important;
        top: var(--navbar-height) !important;
        left: 0 !important;
        right: 0 !important;
        width: 100%;
        max-height: calc(100vh - var(--navbar-height));
        border-radius: 0;
        border: none;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        background: var(--dark-secondary);
        padding: 0.5rem 0;
      }

      .navbar .dropdown-menu .dropdown-item {
        padding: 0.75rem 1.25rem;
        color: var(--light-color);
        display: flex;
        align-items: center;
        transition: background-color 0.2s;
      }

      .navbar .dropdown-menu .dropdown-item:hover,
      .navbar .dropdown-menu .dropdown-item:focus {
        background-color: rgba(255, 255, 255, 0.1);
      }

      .navbar .dropdown-menu .dropdown-divider {
        border-color: rgba(255, 255, 255, 0.1);
        margin: 0.25rem 0;
      }

      .navbar .dropdown-menu .btn-link {
        padding: 0.75rem 1.25rem;
        font-size: 1rem;
      }

      /* User Dropdown specific styles */
      .nav-item.dropdown .dropdown-toggle {
        display: flex;
        align-items: center;
        padding: 0.5rem 1rem;
      }

      .nav-item.dropdown .dropdown-toggle i {
        font-size: 1.1rem;
        margin-right: 0.5rem;
      }

      /* Improved notification display */
      .navbar-badge {
        right: 0.25rem;
      }

      /* Better search bar on mobile */
      .navbar .form-inline {
        width: 100%;
        padding: 0.5rem;
      }
    }

    /* Improved touch targets */
    .nav-link {
      position: relative;
      min-height: 44px;
      display: flex;
      align-items: center;
    }

    /* Better spacing for icons and text */
    .nav-link i {
      margin-right: 0.5rem;
    }

    /* Improved dropdown animations */
    .dropdown-menu {
      transition: transform 0.2s, opacity 0.2s;
      transform-origin: top;
    }

    .dropdown-menu.show {
      transform: scaleY(1);
      opacity: 1;
    }

    /* Better notification center */
    .navbar-nav .messages-menu,
    .navbar-nav .notifications-menu {
      position: static;
    }
  </style>
  <div class="container-fluid">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link px-3" data-widget="pushmenu" href="#" role="button">
          <i class="fas fa-bars"></i>
        </a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="{% url 'accounts:dashboard' %}" class="nav-link">
          <i class="fas fa-home"></i>
          <span class="ml-2">Dashboard</span>
        </a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="{% url 'teams:team_list' %}" class="nav-link">
          <i class="fas fa-users"></i>
          <span class="ml-2">Teams</span>
        </a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="{% url 'projects:project_list' %}" class="nav-link">
          <i class="fas fa-project-diagram"></i>
          <span class="ml-2">Projects</span>
        </a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="{% url 'tasks:task_list' %}" class="nav-link">
          <i class="fas fa-tasks"></i>
          <span class="ml-2">Tasks</span>
        </a>
      </li>
    </ul>

  <!-- Right navbar links -->
  <ul class="navbar-nav ml-auto">
    <!-- Authentication Links -->
    {% if user.is_authenticated %}
    <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <i class="fas fa-user-circle"></i>
        <span class="d-none d-sm-inline">{{ user.username }}</span>
      </a>
      <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
        <div class="d-block d-sm-none dropdown-header text-center py-2">
          <strong>{{ user.username }}</strong>
        </div>
        <a class="dropdown-item" href="{% url 'accounts:profile' %}">
          <i class="fas fa-user-circle mr-2"></i>
          <span>Profile</span>
        </a>
        <a class="dropdown-item" href="{% url 'teams:team_list' %}">
          <i class="fas fa-users mr-2"></i>
          <span>My Teams</span>
        </a>
        <a class="dropdown-item" href="{% url 'projects:project_list' %}">
          <i class="fas fa-project-diagram mr-2"></i>
          <span>My Projects</span>
        </a>
        <div class="dropdown-divider"></div>
        <form action="{% url 'accounts:logout' %}" method="post" class="dropdown-item p-0">
          {% csrf_token %}
          <button type="submit" class="btn btn-link text-danger w-100 text-left">
            <i class="fas fa-sign-out-alt mr-2"></i>
            <span>Logout</span>
          </button>
        </form>
      </div>
    </li>
    {% else %}
    <li class="nav-item">
      <a href="{% url 'accounts:login' %}" class="nav-link">
        <i class="fas fa-sign-in-alt"></i> Login
      </a>
    </li>
    <li class="nav-item">
      <a href="{% url 'accounts:register' %}" class="nav-link">
        <i class="fas fa-user-plus"></i> Register
      </a>
    </li>
    {% endif %}
    
    <!-- Navbar Search -->
    <li class="nav-item">
      <a class="nav-link" data-widget="navbar-search" href="#" role="button">
        <i class="fas fa-search"></i>
      </a>
      <div class="navbar-search-block">
        <form class="form-inline" action="{% url 'search' %}" method="GET">
          <div class="input-group input-group-sm">
            <input class="form-control form-control-navbar" type="search" name="q" placeholder="Search projects, tasks, teams..." aria-label="Search">
            <div class="input-group-append">
              <button class="btn btn-navbar" type="submit">
                <i class="fas fa-search"></i>
              </button>
              <button class="btn btn-navbar" type="button" data-widget="navbar-search">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
        </form>
      </div>
    </li>

    <!-- Notifications Dropdown Menu -->
    {% if user.is_authenticated %}
    <li class="nav-item dropdown">
      <a class="nav-link" data-toggle="dropdown" href="#">
        <i class="far fa-bell"></i>
        {% if notification_count %}
        <span class="badge badge-warning navbar-badge">{{ notification_count }}</span>
        {% endif %}
      </a>
      <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right notification-dropdown">
        {% if latest_notifications %}
        <span class="dropdown-item dropdown-header">{{ notification_count }} Notifications</span>
        <div class="dropdown-divider"></div>
        
        <div class="notification-scroll" style="max-height: 300px; overflow-y: auto;">
          {% for notification in latest_notifications %}
            {% if notification.content_object %}
              <a href="{% if 'Project' in notification.content_object|stringformat:'s' %}{% url 'projects:project_detail' notification.object_id %}{% elif 'Task' in notification.content_object|stringformat:'s' %}{% url 'tasks:task_detail' notification.object_id %}{% else %}#{% endif %}" class="dropdown-item notification-item">
            {% else %}
              <a href="#" class="dropdown-item notification-item">
            {% endif %}
              {% if 'created' in notification.verb %}
                <i class="fas fa-plus-circle mr-2 text-success"></i>
              {% elif 'updated' in notification.verb or 'changed' in notification.verb %}
                <i class="fas fa-edit mr-2 text-primary"></i>
              {% elif 'added' in notification.verb %}
                <i class="fas fa-user-plus mr-2 text-info"></i>
              {% elif 'progress' in notification.verb or 'moved' in notification.verb %}
                <i class="fas fa-tasks mr-2 text-warning"></i>
              {% else %}
                <i class="fas fa-bell mr-2 text-secondary"></i>
              {% endif %}
              <div>
                <p class="mb-0"><strong>{{ notification.actor.username }}</strong> {{ notification.verb }}</p>
                <span class="text-muted text-sm">{{ notification.notification_time_formatted }}</span>
                {% if not notification.content_object %}
                  <span class="badge badge-secondary">Item deleted</span>
                {% endif %}
              </div>
            </a>
            <div class="dropdown-divider"></div>
          {% endfor %}
        </div>
        
        <div class="dropdown-footer d-flex justify-content-between">
          <a href="{% url 'notifications:notification_list' %}" class="btn btn-sm btn-primary">
            <i class="fas fa-eye mr-1"></i> See All
          </a>
          <a href="{% url 'notifications:mark_all_as_read' %}" class="btn btn-sm btn-success">
            <i class="fas fa-check-double mr-1"></i> Mark All Read
          </a>
        </div>
        {% else %}
        <span class="dropdown-item dropdown-header">No notifications</span>
        {% endif %}
      </div>
    </li>
    {% endif %}
    
    <li class="nav-item">
      <a class="nav-link" data-widget="fullscreen" href="#" role="button">
        <i class="fas fa-expand-arrows-alt"></i>
      </a>
    </li>
    
  </ul>
</nav>

<style>
  /* Profile Dropdown Enhancements */
  .dropdown-header {
    color: var(--light-color);
    background-color: rgba(255, 255, 255, 0.05);
  }

  .nav-item.dropdown .dropdown-menu {
    animation: dropdownFade 0.2s ease;
  }

  @keyframes dropdownFade {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .dropdown-item span {
    margin-left: 0.25rem;
  }

  /* Responsive notification dropdown styles */
  .notification-dropdown {
    width: 320px;
    max-width: 100vw;
    padding: 0;
  }
  
  .notification-dropdown .dropdown-header {
    font-weight: bold;
    background-color: #f8f9fa;
    border-bottom: 1px solid #ddd;
  }
  
  .notification-item {
    display: flex;
    align-items: flex-start;
    padding: 10px 15px;
    white-space: normal;
  }
  
  .notification-item:hover {
    background-color: #f8f9fa;
  }
  
  .notification-item div {
    flex: 1;
  }
  
  .notification-item p {
    line-height: 1.2;
  }
  
  .dropdown-footer {
    padding: 8px 12px;
    background-color: #f8f9fa;
    border-top: 1px solid #ddd;
  }
  
  @media (max-width: 576px) {
    .notification-dropdown {
      width: 290px;
    }
    
    .notification-item {
      padding: 8px 12px;
    }
  }
</style>